{% extends 'base.html' %}
{% load static %}
{% load tags %}

{% block title %}Registrar Movimiento de Inventario{% endblock %}
{% block extra_css %}
    <link href="{% static "plugins/select2/dist/css/select2.min.css" %}" rel="stylesheet"/>
{% endblock %}

{% block contenido %}
<h1>Registrar Movimiento de Inventario</h1>

{% if form.non_field_errors %}
    <div class="alert alert-danger">
        {% for error in form.non_field_errors %}
            <p>{{ error }}</p>
        {% endfor %}
    </div>
{% endif %}

<form method="post" id="movimiento-form" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="form-group">
        <label for="id_sucursal">Sucursal Origen:</label>
        {{ form.sucursal }}
    </div>
    <div class="form-group">
        <label for="id_producto">Producto:</label>
        {{ form.producto }}
    </div>
    <div class="form-group">
        <label for="id_tipo_movimiento">Tipo movimiento:</label>
        {{ form.tipo_movimiento }}
    </div>
    <div class="form-group">
        <label for="id_cantidad">Cantidad:</label>
        {{ form.cantidad }}
    </div>
    <div class="form-group">
    <label for="id_comentario">Comentario:</label>
    <input list="razones-sugeridas" class="form-control" name="comentario" id="id_comentario">
    <datalist id="razones-sugeridas">
        <option value="Devolución de producto">
        <option value="Corrección de stock">
        <option value="Transferencia entre sucursales">
        <option value="Ajuste por pérdida">
        <option value="Ajuste por auditoría">
        <option value="Producto defectuoso">
        <option value="Cambio de modelo de lentes">
        <option value="Cambio de montura">
        <option value="Reparación de montura">
        <option value="Ajuste de lentes">
        <option value="Pedido especial">
        <option value="Lentes de contacto no compatibles">
        <option value="Reembolso por producto no entregado">
        <option value="Descuento aplicado incorrectamente">
        <option value="Error en la facturación">
        <option value="Revisión de lentes por problemas de visión">
        <option value="Actualización de prescripción">
        <option value="Solicitud de revisión de stock">
        <option value="Devolución por mal ajuste">
        <option value="Ajuste por rotura del producto">
        <option value="Reposición por pérdida">
    </datalist>
</div>
    <div class="form-group">
        <label for="id_tipo_documento">Tipo de Documento:</label>
        {{ form.tipo_documento }}
    </div>
    <div class="form-group">
        <label for="id_documento_respaldo">Documento Respaldo:</label>
        {{ form.documento_respaldo }}
    </div>
    <div class="form-group">
        <label for="id_documento_soporte">Documento Soporte:</label>
        {{ form.documento_soporte }}
    </div>
    <br>
    <button type="submit" class="btn btn-primary">Registrar Movimiento</button>
</form>
<br>
<br>
<h2>Movimientos Recientes</h2>
<table class="table table-striped">
    <thead>
        <tr>
            <th>Producto</th>
            <th>Sucursal Origen</th>
            <th>Cantidad</th>
            <th>Tipo de Movimiento</th>
            <th>Fecha</th>
            <th>Comentario</th>
        </tr>
    </thead>
    <tbody>
        {% for movimiento in movimientos %}
        <tr>
            <td>{{ movimiento.producto.codigo }} -- {{ movimiento.producto.nombre }}</td>
            <td>{{ movimiento.sucursal.nombre }}</td>
            <td>{{ movimiento.cantidad }}</td>
            <td>{{ movimiento.get_tipo_movimiento_display }}</td>
            <td>{{ movimiento.fecha }}</td>
            <td>{{ movimiento.comentario }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}

{% block extra_js %}
    <script src="{% static 'plugins/select2/dist/js/select2.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Apply Select2 to the select fields
            $('#id_producto').select2({
                placeholder: 'Seleccione un producto',
                allowClear: true
            });

            $('#id_sucursal').select2({
                placeholder: 'Seleccione una sucursal',
                allowClear: true
            });

            $('#id_tipo_documento').select2({
                placeholder: 'Seleccione un tipo de documento',
                allowClear: true
            });id_tipo_documento
        });
    </script>
{% endblock %}